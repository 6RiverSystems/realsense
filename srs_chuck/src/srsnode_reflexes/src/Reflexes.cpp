#include <srsnode_reflexes/Reflexes.hpp>

#include <opencv2/opencv.hpp>

#include <ros/ros.h>
#include <geometry_msgs/Twist.h>

namespace srs {

////////////////////////////////////////////////////////////////////////////////////////////////////
// Public methods

////////////////////////////////////////////////////////////////////////////////////////////////////
Reflexes::Reflexes(string nodeName) :
    rosNodeHandle_(nodeName),
    triggerShutdown_(rosNodeHandle_)
{
}

////////////////////////////////////////////////////////////////////////////////////////////////////
void Reflexes::run()
{
    triggerShutdown_.connectService();

    ros::Rate refreshRate(REFRESH_RATE_HZ);
    while (ros::ok())
    {
        ros::spinOnce();

        evaluateTriggers();

        refreshRate.sleep();
    }
}

////////////////////////////////////////////////////////////////////////////////////////////////////
// Private methods

////////////////////////////////////////////////////////////////////////////////////////////////////
void Reflexes::evaluateTriggers()
{
    if (triggerShutdown_.isShutdownRequested())
    {
        ros::shutdown();
    }
}

} // namespace srs
